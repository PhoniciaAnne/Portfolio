import{_ as U}from"./@babel-98964cd2.js";import{r as f}from"./react-50580a48.js";import{T as ze,R as Lt,O as $e,P as Be,a as xe,L as Ce,b as kt,c as zt,U as Ft,s as at,B as It,M as Ht,W as Wt,C as $t,d as Bt,e as Nt,V as Ut,f as Gt,N as qt,A as Vt,g as Xt,h as B,i as ct,S as Yt,j as Zt,D as Kt,k as ge,l as Jt,m as Qt,n as ie,o as er,p as tr,q as rr}from"./three-b5226650.js";import{u as nr}from"./react-use-measure-178e6db0.js";import{F as or,u as ir}from"./its-fine-4365f0a9.js";import{R as sr,c as oe}from"./react-reconciler-5cbc4306.js";import{s as Ze}from"./scheduler-765c72db.js";import{c as ar}from"./react-dom-2e1edc97.js";import{c as lt}from"./zustand-b687dc28.js";import{G as Ne,D as cr,M as Se,O as lr}from"./three-stdlib-5204d2b3.js";import{s as ur,p as fr,c as dr}from"./suspend-react-00b64780.js";var Ke,Je;const pr=(e,...t)=>t.reduce((r,i)=>r==null?void 0:r[i],e),te="ColorManagement"in ze&&pr(ze,"ColorManagement")||null,ut=e=>e&&e.isOrthographicCamera,mr=e=>e&&e.hasOwnProperty("current"),pe=typeof window<"u"&&((Ke=window.document)!=null&&Ke.createElement||((Je=window.navigator)==null?void 0:Je.product)==="ReactNative")?f.useLayoutEffect:f.useEffect;function ft(e){const t=f.useRef(e);return pe(()=>void(t.current=e),[e]),t}function vr({set:e}){return pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class dt extends f.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}dt.getDerivedStateFromError=()=>({error:!0});const pt="__default",Qe=new Map,hr=e=>e&&!!e.memoized&&!!e.changes;function mt(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},A={obj:e=>e===Object(e)&&!A.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(A.str(e)||A.num(e))return e===t;const l=A.obj(e);if(l&&i==="reference")return e===t;const h=A.arr(e);if(h&&r==="reference")return e===t;if((h||l)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;for(v in a?t:e)if(e[v]!==t[v])return!1;if(A.und(v)){if(h&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function gr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function yr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const r=e;return(t!=null&&t.primitive||!r.__r3f)&&(r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Fe(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((l,h)=>l[h],e),{target:r,key:a}}else return{target:r,key:t}}const et=/-\d+$/;function Oe(e,t,r){if(A.str(r)){if(et.test(r)){const l=r.replace(et,""),{target:h,key:v}=Fe(e,l);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:a}=Fe(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function tt(e,t,r){var i,a;if(A.str(r)){const{target:l,key:h}=Fe(e,r),v=t.__r3f.previousAttach;v===void 0?delete l[h]:l[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function vt(e,{children:t,key:r,ref:i,...a},{children:l,key:h,ref:v,...s}={},g=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},d=Object.entries(a),p=[];if(g){const P=Object.keys(s);for(let y=0;y<P.length;y++)a.hasOwnProperty(P[y])||d.unshift([P[y],pt+"remove"])}d.forEach(([P,y])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&P==="object"||A.equ(y,s[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return p.push([P,y,!0,[]]);let u=[];P.includes("-")&&(u=P.split("-")),p.push([P,y,!1,u]);for(const b in a){const M=a[b];b.startsWith(`${P}-`)&&p.push([b,M,!1,b.split("-")])}});const m={...a};return o.memoizedProps&&o.memoizedProps.args&&(m.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(m.attach=o.memoizedProps.attach),{memoized:m,changes:p}}function Re(e,t){var r,i,a;const l=(r=e.__r3f)!=null?r:{},h=l.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:g}=hr(t)?t:vt(e,t),n=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let d=0;d<g.length;d++){let[p,m,P,y]=g[d],c=e,u=c[p];if(y.length&&(u=y.reduce((b,M)=>b[M],e),!(u&&u.set))){const[b,...M]=y.reverse();c=M.reverse().reduce((E,w)=>E[w],e),p=b}if(m===pt+"remove")if(c.constructor){let b=Qe.get(c.constructor);b||(b=new c.constructor,Qe.set(c.constructor,b)),m=b[p]}else m=0;if(P)m?l.handlers[p]=m:delete l.handlers[p],l.eventCount=Object.keys(l.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Ce)){if(Array.isArray(m))u.fromArray?u.fromArray(m):u.set(...m);else if(u.copy&&m&&m.constructor&&u.constructor===m.constructor)u.copy(m);else if(m!==void 0){const b=u instanceof Xt;!b&&u.setScalar?u.setScalar(m):u instanceof Ce&&m instanceof Ce?u.mask=m.mask:u.set(m),!te&&!v.linear&&b&&u.convertSRGBToLinear()}}else c[p]=m,!v.linear&&c[p]instanceof kt&&c[p].format===zt&&c[p].type===Ft&&(c[p].encoding=at);ne(e)}if(l.parent&&v.internal&&e.raycast&&n!==l.eventCount){const d=v.internal.interaction.indexOf(e);d>-1&&v.internal.interaction.splice(d,1),l.eventCount&&v.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(a=e.__r3f)!=null&&a.parent&&Ie(e),e}function ne(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Ie(e){e.onUpdate==null||e.onUpdate(e)}function br(e,t){e.manual||(ut(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ye(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function wr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return oe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return oe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return oe.ContinuousEventPriority;default:return oe.DefaultEventPriority}}function ht(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function _r(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{ht(r.capturedMap,t,i,a)})}function Pr(e){function t(s){const{internal:g}=e.getState(),n=s.offsetX-g.initialClick[0],o=s.offsetY-g.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(s){return s.filter(g=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(s,g){const n=e.getState(),o=new Set,d=[],p=g?g(n.internal.interaction):n.internal.interaction;for(let c=0;c<p.length;c++){const u=ce(p[c]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function m(c){const u=ce(c);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var b;u.events.compute==null||u.events.compute(s,u,(b=u.previousRoot)==null?void 0:b.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(c,!0):[]}let P=p.flatMap(m).sort((c,u)=>{const b=ce(c.object),M=ce(u.object);return!b||!M?c.distance-u.distance:M.events.priority-b.events.priority||c.distance-u.distance}).filter(c=>{const u=ye(c);return o.has(u)?!1:(o.add(u),!0)});n.events.filter&&(P=n.events.filter(P,n));for(const c of P){let u=c.object;for(;u;){var y;(y=u.__r3f)!=null&&y.eventCount&&d.push({...c,eventObject:u}),u=u.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let c of n.internal.capturedMap.get(s.pointerId).values())o.has(ye(c.intersection))||d.push(c.intersection);return d}function a(s,g,n,o){const d=e.getState();if(s.length){const p={stopped:!1};for(const m of s){const P=ce(m.object)||d,{raycaster:y,pointer:c,camera:u,internal:b}=P,M=new B(c.x,c.y,0).unproject(u),E=x=>{var C,z;return(C=(z=b.capturedMap.get(x))==null?void 0:z.has(m.eventObject))!=null?C:!1},w=x=>{const C={intersection:m,target:g.target};b.capturedMap.has(x)?b.capturedMap.get(x).set(m.eventObject,C):b.capturedMap.set(x,new Map([[m.eventObject,C]])),g.target.setPointerCapture(x)},S=x=>{const C=b.capturedMap.get(x);C&&ht(b.capturedMap,m.eventObject,C,x)};let j={};for(let x in g){let C=g[x];typeof C!="function"&&(j[x]=C)}let _={...m,...j,pointer:c,intersections:s,stopped:p.stopped,delta:n,unprojectedPoint:M,ray:y.ray,camera:u,stopPropagation(){const x="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!x||x.has(m.eventObject))&&(_.stopped=p.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(C=>C.eventObject===m.eventObject))){const C=s.slice(0,s.indexOf(m));l([...C,m])}},target:{hasPointerCapture:E,setPointerCapture:w,releasePointerCapture:S},currentTarget:{hasPointerCapture:E,setPointerCapture:w,releasePointerCapture:S},nativeEvent:g};if(o(_),p.stopped===!0)break}}return s}function l(s){const{internal:g}=e.getState();for(const n of g.hovered.values())if(!s.length||!s.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const d=n.eventObject.__r3f,p=d==null?void 0:d.handlers;if(g.hovered.delete(ye(n)),d!=null&&d.eventCount){const m={...n,intersections:s};p.onPointerOut==null||p.onPointerOut(m),p.onPointerLeave==null||p.onPointerLeave(m)}}}function h(s,g){for(let n=0;n<g.length;n++){const o=g[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return g=>{const{internal:n}=e.getState();"pointerId"in g&&n.capturedMap.has(g.pointerId)&&(n.capturedMap.delete(g.pointerId),l([]))}}return function(n){const{onPointerMissed:o,internal:d}=e.getState();d.lastEvent.current=n;const p=s==="onPointerMove",m=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(n,p?r:void 0),c=m?t(n):0;s==="onPointerDown"&&(d.initialClick=[n.offsetX,n.offsetY],d.initialHits=y.map(b=>b.eventObject)),m&&!y.length&&c<=2&&(h(n,d.interaction),o&&o(n)),p&&l(y);function u(b){const M=b.eventObject,E=M.__r3f,w=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(p){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const S=ye(b),j=d.hovered.get(S);j?j.stopped&&b.stopPropagation():(d.hovered.set(S,b),w.onPointerOver==null||w.onPointerOver(b),w.onPointerEnter==null||w.onPointerEnter(b))}w.onPointerMove==null||w.onPointerMove(b)}else{const S=w[s];S?(!m||d.initialHits.includes(M))&&(h(n,d.interaction.filter(j=>!d.initialHits.includes(j))),S(b)):m&&d.initialHits.includes(M)&&h(n,d.interaction.filter(j=>!d.initialHits.includes(j)))}}a(y,n,c,u)}}return{handlePointer:v}}let He={},Er=e=>void(He={...He,...e});function Mr(e,t){function r(n,{args:o=[],attach:d,...p},m){let P=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=p.object;y=re(c,{type:n,root:m,attach:d,primitive:!0})}else{const c=He[P];if(!c)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=re(new c(...o),{type:n,root:m,attach:d,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof It?y.__r3f.attach="geometry":y instanceof Ht&&(y.__r3f.attach="material")),P!=="inject"&&Re(y,p),y}function i(n,o){let d=!1;if(o){var p,m;(p=o.__r3f)!=null&&p.attach?Oe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),d=!0),d||(m=n.__r3f)==null||m.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=n,Ie(o),ne(o)}}function a(n,o,d){let p=!1;if(o){var m,P;if((m=o.__r3f)!=null&&m.attach)Oe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const y=n.children.filter(u=>u!==o),c=y.indexOf(d);n.children=[...y.slice(0,c),o,...y.slice(c)],p=!0}p||(P=n.__r3f)==null||P.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=n,Ie(o),ne(o)}}function l(n,o,d=!1){n&&[...n].forEach(p=>h(o,p,d))}function h(n,o,d){if(o){var p,m,P;if(o.__r3f&&(o.__r3f.parent=null),(p=n.__r3f)!=null&&p.objects&&(n.__r3f.objects=n.__r3f.objects.filter(M=>M!==o)),(m=o.__r3f)!=null&&m.attach)tt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var y;n.remove(o),(y=o.__r3f)!=null&&y.root&&_r(o.__r3f.root,o)}const u=(P=o.__r3f)==null?void 0:P.primitive,b=d===void 0?o.dispose!==null&&!u:d;if(!u){var c;l((c=o.__r3f)==null?void 0:c.objects,o,b),l(o.children,o,b)}o.__r3f&&(delete o.__r3f.root,delete o.__r3f.objects,delete o.__r3f.handlers,delete o.__r3f.memoizedProps,u||delete o.__r3f),b&&o.dispose&&o.type!=="Scene"&&Ze.unstable_scheduleCallback(Ze.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),ne(n)}}function v(n,o,d,p){var m;const P=(m=n.__r3f)==null?void 0:m.parent;if(!P)return;const y=r(o,d,n.__r3f.root);if(n.children){for(const c of n.children)c.__r3f&&i(y,c);n.children=n.children.filter(c=>!c.__r3f)}n.__r3f.objects.forEach(c=>i(y,c)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(P,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(P,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[p,p.alternate].forEach(c=>{c!==null&&(c.stateNode=y,c.ref&&(typeof c.ref=="function"?c.ref(y):c.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:sr({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const d=n.getState().scene;d.__r3f&&(d.__r3f.root=n,i(d,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,d)=>{if(!o||!d)return;const p=n.getState().scene;p.__r3f&&a(p,o,d)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,d,p){if(n.__r3f.primitive&&p.object&&p.object!==n)return[!0];{const{args:m=[],children:P,...y}=p,{args:c=[],children:u,...b}=d;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((E,w)=>E!==c[w]))return[!0];const M=vt(n,y,b,!0);return M.changes.length?[!1,M]:null}},commitUpdate(n,[o,d],p,m,P,y){o?v(n,p,P,y):Re(n,d)},commitMount(n,o,d,p){var m;const P=(m=n.__r3f)!=null?m:{};n.raycast&&P.handlers&&P.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>re(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:d,parent:p}=(o=n.__r3f)!=null?o:{};d&&p&&tt(p,n,d),n.isObject3D&&(n.visible=!1),ne(n)},unhideInstance(n,o){var d;const{attach:p,parent:m}=(d=n.__r3f)!=null?d:{};p&&m&&Oe(m,n,p),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ne(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():oe.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&A.fun(performance.now)?performance.now:A.fun(Date.now)?Date.now:()=>0,scheduleTimeout:A.fun(setTimeout)?setTimeout:void 0,cancelTimeout:A.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Re}}const gt=e=>!!(e!=null&&e.render),yt=f.createContext(null),xr=(e,t)=>{const r=lt((v,s)=>{const g=new B,n=new B,o=new B;function d(c=s().camera,u=n,b=s().size){const{width:M,height:E,top:w,left:S}=b,j=M/E;u instanceof B?o.copy(u):o.set(...u);const _=c.getWorldPosition(g).distanceTo(o);if(ut(c))return{width:M/c.zoom,height:E/c.zoom,top:w,left:S,factor:1,distance:_,aspect:j};{const x=c.fov*Math.PI/180,C=2*Math.tan(x/2)*_,z=C*(M/E);return{width:z,height:C,top:w,left:S,factor:M/z,distance:_,aspect:j}}}let p;const m=c=>v(u=>({performance:{...u.performance,current:c}})),P=new ct;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:(c=1)=>e(s(),c),advance:(c,u)=>t(c,u,s()),legacy:!1,linear:!1,flat:!1,scene:re(new Yt),controls:null,clock:new Zt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=s();p&&clearTimeout(p),c.performance.current!==c.performance.min&&m(c.performance.min),p=setTimeout(()=>m(s().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:c=>v(u=>({...u,events:{...u.events,...c}})),setSize:(c,u,b,M,E)=>{const w=s().camera,S={width:c,height:u,top:M||0,left:E||0,updateStyle:b};v(j=>({size:S,viewport:{...j.viewport,...d(w,n,S)}}))},setDpr:c=>v(u=>{const b=mt(c);return{viewport:{...u.viewport,dpr:b,initialDpr:u.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const u=s().clock;u.stop(),u.elapsedTime=0,c!=="never"&&(u.start(),u.elapsedTime=0),v(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:f.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,u,b)=>{const M=s().internal;return M.priority=M.priority+(u>0?1:0),M.subscribers.push({ref:c,priority:u,store:b}),M.subscribers=M.subscribers.sort((E,w)=>E.priority-w.priority),()=>{const E=s().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(u>0?1:0),E.subscribers=E.subscribers.filter(w=>w.ref!==c))}}}}}),i=r.getState();let a=i.size,l=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:g,gl:n,set:o}=r.getState();if(s!==a||g.dpr!==l){var d;a=s,l=g.dpr,br(v,s),n.setPixelRatio(g.dpr);const p=(d=s.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,p)}v!==h&&(h=v,o(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let be,Cr=new Set,Sr=new Set,Or=new Set;function je(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function le(e,t){switch(e){case"before":return je(Cr,t);case"after":return je(Sr,t);case"tail":return je(Or,t)}}let Ae,Te;function De(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Ae=t.internal.subscribers,be=0;be<Ae.length;be++)Te=Ae[be],Te.ref.current(Te.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Rr(e){let t=!1,r,i,a;function l(s){i=requestAnimationFrame(l),t=!0,r=0,le("before",s);for(const n of e.values()){var g;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((g=a.gl.xr)!=null&&g.isPresenting)&&(r+=De(s,a))}if(le("after",s),r===0)return le("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,g=1){var n;if(!s)return e.forEach(o=>h(o.store.getState()),g);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+g),t||(t=!0,requestAnimationFrame(l)))}function v(s,g=!0,n,o){if(g&&le("before",s),n)De(s,n,o);else for(const d of e.values())De(s,d.store.getState());g&&le("after",s)}return{loop:l,invalidate:h,advance:v}}function bt(){const e=f.useContext(yt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function W(e=r=>r,t){return bt()(e,t)}function Ee(e,t=0){const r=bt(),i=r.getState().internal.subscribe,a=ft(e);return pe(()=>i(a,t,r),[t,i,r]),null}function wt(e,t){return function(r,...i){const a=new r;return e&&e(a),Promise.all(i.map(l=>new Promise((h,v)=>a.load(l,s=>{s.scene&&Object.assign(s,gr(s.scene)),h(s)},t,s=>v(new Error(`Could not load ${l}: ${s.message})`))))))}}function me(e,t,r,i){const a=Array.isArray(t)?t:[t],l=ur(wt(r,i),[e,...a],{equal:A.equ});return Array.isArray(t)?l:l[0]}me.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return fr(wt(r),[e,...i])};me.clear=function(e,t){const r=Array.isArray(t)?t:[t];return dr([e,...r])};const se=new Map,{invalidate:rt,advance:nt}=Rr(se),{reconciler:Pe,applyProps:we}=Mr(se,wr),ue={objects:"shallow",strict:!1},jr=(e,t)=>{const r=typeof e=="function"?e(t):e;return gt(r)?r:new Wt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Ar(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:a,left:l}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:a,left:l}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Tr(e){const t=se.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,l=i||xr(rt,nt),h=r||Pe.createContainer(l,oe.ConcurrentRoot,null,!1,null,"",a,null);t||se.set(e,{fiber:h,store:l});let v,s=!1;return{configure(g={}){let{gl:n,size:o,events:d,onCreated:p,shadows:m=!1,linear:P=!1,flat:y=!1,legacy:c=!1,orthographic:u=!1,frameloop:b="always",dpr:M=[1,2],performance:E,raycaster:w,camera:S,onPointerMissed:j}=g,_=l.getState(),x=_.gl;_.gl||_.set({gl:x=jr(n,e)});let C=_.raycaster;C||_.set({raycaster:C=new Lt});const{params:z,...K}=w||{};if(A.equ(K,C,ue)||we(C,{...K}),A.equ(z,C.params,ue)||we(C,{params:{...C.params,...z}}),!_.camera){const F=S instanceof $t,D=F?S:u?new $e(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);F||(D.position.z=5,S&&we(D,S),S!=null&&S.rotation||D.lookAt(0,0,0)),_.set({camera:D})}if(!_.xr){const F=(O,$)=>{const k=l.getState();k.frameloop!=="never"&&nt(O,!0,k,$)},D=()=>{const O=l.getState();O.gl.xr.enabled=O.gl.xr.isPresenting,O.gl.xr.setAnimationLoop(O.gl.xr.isPresenting?F:null),O.gl.xr.isPresenting||rt(O)},H={connect(){const O=l.getState().gl;O.xr.addEventListener("sessionstart",D),O.xr.addEventListener("sessionend",D)},disconnect(){const O=l.getState().gl;O.xr.removeEventListener("sessionstart",D),O.xr.removeEventListener("sessionend",D)}};x.xr&&H.connect(),_.set({xr:H})}if(x.shadowMap){const F=x.shadowMap.enabled,D=x.shadowMap.type;if(x.shadowMap.enabled=!!m,A.boo(m))x.shadowMap.type=xe;else if(A.str(m)){var q;const H={basic:Bt,percentage:Nt,soft:xe,variance:Ut};x.shadowMap.type=(q=H[m])!=null?q:xe}else A.obj(m)&&Object.assign(x.shadowMap,m);(F!==x.shadowMap.enabled||D!==x.shadowMap.type)&&(x.shadowMap.needsUpdate=!0)}te&&("enabled"in te?te.enabled=!c:"legacyMode"in te&&(te.legacyMode=c));const L=P?Gt:at,G=y?qt:Vt;x.outputEncoding!==L&&(x.outputEncoding=L),x.toneMapping!==G&&(x.toneMapping=G),_.legacy!==c&&_.set(()=>({legacy:c})),_.linear!==P&&_.set(()=>({linear:P})),_.flat!==y&&_.set(()=>({flat:y})),n&&!A.fun(n)&&!gt(n)&&!A.equ(n,x,ue)&&we(x,n),d&&!_.events.handlers&&_.set({events:d(l)});const T=Ar(e,o);return A.equ(T,_.size,ue)||_.setSize(T.width,T.height,T.updateStyle,T.top,T.left),M&&_.viewport.dpr!==mt(M)&&_.setDpr(M),_.frameloop!==b&&_.setFrameloop(b),_.onPointerMissed||_.set({onPointerMissed:j}),E&&!A.equ(E,_.performance,ue)&&_.set(F=>({performance:{...F.performance,...E}})),v=p,s=!0,this},render(g){return s||this.configure(),Pe.updateContainer(f.createElement(Dr,{store:l,children:g,onCreated:v,rootElement:e}),h,null,()=>{}),l},unmount(){_t(e)}}}function Dr({store:e,children:t,onCreated:r,rootElement:i}){return pe(()=>{const a=e.getState();a.set(l=>({internal:{...l.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),f.createElement(yt.Provider,{value:e},t)}function _t(e,t){const r=se.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),Pe.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var l,h,v,s;a.events.disconnect==null||a.events.disconnect(),(l=a.gl)==null||(h=l.renderLists)==null||h.dispose==null||h.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),yr(a),se.delete(e),t&&t(e)}catch{}},500)})}}Pe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version});const Le={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Lr(e){const{handlePointer:t}=Pr(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Le).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:l}=e.getState();l.disconnect==null||l.disconnect(),a(h=>({events:{...h.events,connected:r}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([h,v])=>{const[s,g]=Le[h];r.addEventListener(s,v,{passive:g})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([l,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Le[l];i.connected.removeEventListener(v,h)}}),r(l=>({events:{...l.events,connected:void 0}}))}}}}const kr=f.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:l,events:h=Lr,eventSource:v,eventPrefix:s,shadows:g,linear:n,flat:o,legacy:d,orthographic:p,frameloop:m,dpr:P,performance:y,raycaster:c,camera:u,onPointerMissed:b,onCreated:M,...E},w){f.useMemo(()=>Er(ze),[]);const S=ir(),[j,_]=nr({scroll:!0,debounce:{scroll:50,resize:0},...i}),x=f.useRef(null),C=f.useRef(null),[z,K]=f.useState(null);f.useImperativeHandle(w,()=>x.current);const q=ft(b),[L,G]=f.useState(!1),[T,F]=f.useState(!1);if(L)throw L;if(T)throw T;const D=f.useRef(null);_.width>0&&_.height>0&&z&&(D.current||(D.current=Tr(z)),D.current.configure({gl:l,events:h,shadows:g,linear:n,flat:o,legacy:d,orthographic:p,frameloop:m,dpr:P,performance:y,raycaster:c,camera:u,size:_,onPointerMissed:(...O)=>q.current==null?void 0:q.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(v?mr(v)?v.current:v:C.current),s&&O.setEvents({compute:($,k)=>{const J=$[s+"X"],Q=$[s+"Y"];k.pointer.set(J/k.size.width*2-1,-(Q/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),M==null||M(O)}}),D.current.render(f.createElement(S,null,f.createElement(dt,{set:F},f.createElement(f.Suspense,{fallback:f.createElement(vr,{set:G})},t))))),pe(()=>{K(x.current)},[]),f.useEffect(()=>{if(z)return()=>_t(z)},[z]);const H=v?"none":"auto";return f.createElement("div",U({ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:H,...a}},E),f.createElement("div",{ref:j,style:{width:"100%",height:"100%"}},f.createElement("canvas",{ref:x,style:{display:"block"}},r)))}),cn=f.forwardRef(function(t,r){return f.createElement(or,null,f.createElement(kr,U({},t,{ref:r})))}),ve=new B,Ue=new B,zr=new B,ot=new ct;function Fr(e,t,r){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,l=r.height/2;return[i.x*a+a,-(i.y*l)+l]}function Ir(e,t){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),l=t.getWorldDirection(zr);return a.angleTo(l)>Math.PI/2}function Hr(e,t,r,i){const a=ve.setFromMatrixPosition(e.matrixWorld),l=a.clone();l.project(t),ot.set(l.x,l.y),r.setFromCamera(ot,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return a.distanceTo(r.ray.origin)<v}return!0}function Wr(e,t){if(t instanceof $e)return t.zoom;if(t instanceof Be){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,l=r.distanceTo(i);return 1/(2*Math.tan(a/2)*l)}else return 1}function $r(e,t,r){if(t instanceof Be||t instanceof $e){const i=ve.setFromMatrixPosition(e.matrixWorld),a=Ue.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(a),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*l+v)}}const We=e=>Math.abs(e)<1e-10?0:e;function Pt(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=We(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Br=(e=>t=>Pt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Nr=(e=>(t,r)=>Pt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Ur(e){return e&&typeof e=="object"&&"current"in e}const ln=f.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:l,fullscreen:h,portal:v,distanceFactor:s,sprite:g=!1,transform:n=!1,occlude:o,onOcclude:d,castShadow:p,receiveShadow:m,material:P,geometry:y,zIndexRange:c=[16777271,0],calculatePosition:u=Fr,as:b="div",wrapperClass:M,pointerEvents:E="auto",...w},S)=>{const{gl:j,camera:_,scene:x,size:C,raycaster:z,events:K,viewport:q}=W(),[L]=f.useState(()=>document.createElement(b)),G=f.useRef(),T=f.useRef(null),F=f.useRef(0),D=f.useRef([0,0]),H=f.useRef(null),O=f.useRef(null),$=(v==null?void 0:v.current)||K.connected||j.domElement.parentNode,k=f.useRef(null),J=f.useRef(!1),Q=f.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Ur(o[0]),[o]);f.useLayoutEffect(()=>{const I=j.domElement;o&&o==="blending"?(I.style.zIndex=`${Math.floor(c[0]/2)}`,I.style.position="absolute",I.style.pointerEvents="none"):(I.style.zIndex=null,I.style.position=null,I.style.pointerEvents=null)},[o]),f.useLayoutEffect(()=>{if(T.current){const I=G.current=ar(L);if(x.updateMatrixWorld(),n)L.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const R=u(T.current,_,C);L.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${R[0]}px,${R[1]}px,0);transform-origin:0 0;`}return $&&(a?$.prepend(L):$.appendChild(L)),()=>{$&&$.removeChild(L),I.unmount()}}},[$,n]),f.useLayoutEffect(()=>{M&&(L.className=M)},[M]);const qe=f.useMemo(()=>n?{position:"absolute",top:0,left:0,width:C.width,height:C.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...h&&{top:-C.height/2,left:-C.width/2,width:C.width,height:C.height},...r},[r,l,h,C,n]),Ct=f.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);f.useLayoutEffect(()=>{if(J.current=!1,n){var I;(I=G.current)==null||I.render(f.createElement("div",{ref:H,style:qe},f.createElement("div",{ref:O,style:Ct},f.createElement("div",{ref:S,className:i,style:r,children:e}))))}else{var R;(R=G.current)==null||R.render(f.createElement("div",{ref:S,style:qe,className:i,children:e}))}});const ee=f.useRef(!0);Ee(I=>{if(T.current){_.updateMatrixWorld(),T.current.updateWorldMatrix(!0,!1);const R=n?D.current:u(T.current,_,C);if(n||Math.abs(F.current-_.zoom)>t||Math.abs(D.current[0]-R[0])>t||Math.abs(D.current[1]-R[1])>t){const V=Ir(T.current,_);let N=!1;Q&&(Array.isArray(o)?N=o.map(X=>X.current):o!=="blending"&&(N=[x]));const ae=ee.current;if(N){const X=Hr(T.current,_,z,N);ee.current=X&&!V}else ee.current=!V;ae!==ee.current&&(d?d(!ee.current):L.style.display=ee.current?"block":"none");const he=Math.floor(c[0]/2),St=o?Q?[c[0],he]:[he-1,0]:c;if(L.style.zIndex=`${$r(T.current,_,St)}`,n){const[X,Xe]=[C.width/2,C.height/2],Me=_.projectionMatrix.elements[5]*Xe,{isOrthographicCamera:Ye,top:Ot,left:Rt,bottom:jt,right:At}=_,Tt=Br(_.matrixWorldInverse),Dt=Ye?`scale(${Me})translate(${We(-(At+Rt)/2)}px,${We((Ot+jt)/2)}px)`:`translateZ(${Me}px)`;let Y=T.current.matrixWorld;g&&(Y=_.matrixWorldInverse.clone().transpose().copyPosition(Y).scale(T.current.scale),Y.elements[3]=Y.elements[7]=Y.elements[11]=0,Y.elements[15]=1),L.style.width=C.width+"px",L.style.height=C.height+"px",L.style.perspective=Ye?"":`${Me}px`,H.current&&O.current&&(H.current.style.transform=`${Dt}${Tt}translate(${X}px,${Xe}px)`,O.current.style.transform=Nr(Y,1/((s||10)/400)))}else{const X=s===void 0?1:Wr(T.current,_)*s;L.style.transform=`translate3d(${R[0]}px,${R[1]}px,0) scale(${X})`}D.current=R,F.current=_.zoom}}if(!Q&&k.current&&!J.current)if(n){if(H.current){const R=H.current.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const{isOrthographicCamera:V}=_;if(V||y)w.scale&&(Array.isArray(w.scale)?w.scale instanceof B?k.current.scale.copy(w.scale.clone().divideScalar(1)):k.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):k.current.scale.setScalar(1/w.scale));else{const N=(s||10)/400,ae=R.clientWidth*N,he=R.clientHeight*N;k.current.scale.set(ae,he,1)}J.current=!0}}}else{const R=L.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const V=1/q.factor,N=R.clientWidth*V,ae=R.clientHeight*V;k.current.scale.set(N,ae,1),J.current=!0}k.current.lookAt(I.camera.position)}});const Ve=f.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return f.createElement("group",U({},w,{ref:T}),o&&!Q&&f.createElement("mesh",{castShadow:p,receiveShadow:m,ref:k},y||f.createElement("planeGeometry",null),P||f.createElement("shaderMaterial",{side:Kt,vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader})))});let fe=0;const un=lt(e=>(ge.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100})},ge.onLoad=()=>{e({active:!1})},ge.onError=t=>e(r=>({errors:[...r.errors,t]})),ge.onProgress=(t,r,i)=>{r===i&&(fe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Gr=()=>parseInt(Jt.replace(/\D+/g,"")),Et=Gr();let _e=null,Mt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function xt(e,t,r){return i=>{r&&r(i),e&&(_e||(_e=new cr),_e.setDecoderPath(typeof e=="string"?e:Mt),i.setDRACOLoader(_e)),t&&i.setMeshoptDecoder(typeof Se=="function"?Se():Se)}}function Ge(e,t=!0,r=!0,i){return me(Ne,e,xt(t,r,i))}Ge.preload=(e,t=!0,r=!0,i)=>me.preload(Ne,e,xt(t,r,i));Ge.clear=e=>me.clear(Ne,e);Ge.setDecoderPath=e=>{Mt=e};const fn=f.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:a=!0,keyEvents:l=!1,onChange:h,onStart:v,onEnd:s,...g},n)=>{const o=W(w=>w.invalidate),d=W(w=>w.camera),p=W(w=>w.gl),m=W(w=>w.events),P=W(w=>w.setEvents),y=W(w=>w.set),c=W(w=>w.get),u=W(w=>w.performance),b=t||d,M=i||m.connected||p.domElement,E=f.useMemo(()=>new lr(b),[b]);return Ee(()=>{E.enabled&&E.update()},-1),f.useEffect(()=>(l&&E.connect(l===!0?M:l),E.connect(M),()=>void E.dispose()),[l,M,r,E,o]),f.useEffect(()=>{const w=_=>{o(),r&&u.regress(),h&&h(_)},S=_=>{v&&v(_)},j=_=>{s&&s(_)};return E.addEventListener("change",w),E.addEventListener("start",S),E.addEventListener("end",j),()=>{E.removeEventListener("start",S),E.removeEventListener("end",j),E.removeEventListener("change",w)}},[h,v,s,E,o,P]),f.useEffect(()=>{if(e){const w=c().controls;return y({controls:E}),()=>y({controls:w})}},[e,E]),f.createElement("primitive",U({ref:n,object:E,enableDamping:a},g))}),ke=Et>=154?"opaque_fragment":"output_fragment";class qr extends Qt{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:a}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${ke}>`,`
        ${a?`#include <${ke}>`:`#extension GL_OES_standard_derivatives : enable
#include <${ke}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Et>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const dn=f.forwardRef((e,t)=>{const[r]=f.useState(()=>new qr(null));return f.createElement("primitive",U({},e,{object:r,ref:t,attach:"material"}))});let Z,de;const Vr=f.createContext(null),it=new er,st=new B,Xr=f.forwardRef(({children:e,range:t,limit:r=1e3,...i},a)=>{const l=f.useRef(null);f.useImperativeHandle(a,()=>l.current,[]);const[h,v]=f.useState([]),[[s,g,n]]=f.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);f.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),Ee(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),it.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),Z=0;Z<h.length;Z++)de=h[Z].current,de.getWorldPosition(st).applyMatrix4(it),st.toArray(s,Z*3),l.current.geometry.attributes.position.needsUpdate=!0,de.matrixWorldNeedsUpdate=!0,de.color.toArray(g,Z*3),l.current.geometry.attributes.color.needsUpdate=!0,n.set([de.size],Z),l.current.geometry.attributes.size.needsUpdate=!0});const o=f.useMemo(()=>({getParent:()=>l,subscribe:d=>(v(p=>[...p,d]),()=>v(p=>p.filter(m=>m.current!==d.current)))}),[]);return f.createElement("points",U({userData:{instances:h},matrixAutoUpdate:!1,ref:l,raycast:()=>null},i),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:ie}),f.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ie}),f.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ie})),f.createElement(Vr.Provider,{value:o},e))}),Yr=f.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:a=3,...l},h)=>{const v=f.useRef(null);return f.useImperativeHandle(h,()=>v.current,[]),Ee(()=>{const s=v.current.geometry.attributes;s.position.needsUpdate=!0,r&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),f.createElement("points",U({ref:v},l),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ie}),r&&f.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:ie}),i&&f.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:ie})),e)}),pn=f.forwardRef((e,t)=>e.positions instanceof Float32Array?f.createElement(Yr,U({},e,{ref:t})):f.createElement(Xr,U({},e,{ref:t})));function mn({all:e,scene:t,camera:r}){const i=W(({gl:h})=>h),a=W(({camera:h})=>h),l=W(({scene:h})=>h);return f.useLayoutEffect(()=>{const h=[];e&&(t||l).traverse(g=>{g.visible===!1&&(h.push(g),g.visible=!0)}),i.compile(t||l,r||a);const v=new tr(128);new rr(.01,1e5,v).update(i,t||l),v.dispose(),h.forEach(g=>g.visible=!1)},[]),null}export{cn as C,ln as H,fn as O,mn as P,Ge as a,Ee as b,pn as c,dn as d,un as u};
